RewriteEngine On

# ==================== CORS CONFIGURATION ====================
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, PATCH"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With, Accept, Origin, Access-Control-Request-Method, Access-Control-Request-Headers"
Header always set Access-Control-Allow-Credentials "true"
Header always set Access-Control-Expose-Headers "Authorization"

# Handle preflight OPTIONS requests
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ $1 [R=200,L]

# ==================== API ROUTING ====================
# ✅ PENTING: JANGAN rewrite request ke folder api/
RewriteCond %{REQUEST_URI} ^/api/ [NC]
RewriteRule ^ - [L]

# ==================== SECURITY ====================
<FilesMatch "\.php$">
    Require all granted
</FilesMatch>

<Files "\.(env|config|log)$">
    Require all denied
</Files>

<Files "config.php">
    Require all denied
</Files>

# ==================== PHP CONFIG ====================
php_value error_log /home/nurdiansyah/appKoperasi/public_html/api/error_log
php_flag log_errors on
php_value error_reporting E_ALL

# ==================== SPA ROUTING ====================
# ✅ HANYA untuk request yang bukan ke api/
RewriteCond %{REQUEST_URI} !^/api/ [NC]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ /index.html [L,QSA]